服务器简要部署文档
====


# 1 安装 python

python > 3.7

# 2 安装依赖包

pip install -r requirements.txt

# 3 单独运行 开发网站
 
仅允许本机访问 python manage.py runserver 127.0.0.1:8080

允许局域网内的其他机器访问 python manage.py runserver 127.0.0.1:8080

本机访问的地址是 http://127.0.0.1:8080

注意您需要把网站上的数据【全部删除】，进入网站后台

# 4 运行主机监视程序

python  batch_check_online.py

# 5 运行文件下载同步服务

python batch_download_file.py

注意 发现新文件的筛选机制是基于文件的时间戳，每次下载文件都会记录一个最新的文件的时间戳，下一次只关注比这个时间戳新的文件

# 6 使用 supervisor 同时运行 3、4、5
运行的命令是

python supervisor_api.py run

在运行之前必须做些工作：重新生成配置文件
- 设置 supervisord 基础配置 python supervisor_api.py setup-server
- 生成django 网站配置文件 python supervisor_api.py setup-app-django-web
- 生成批量主机在线检查的配置文件 python supervisor_api.py setup-app-batch-check
- 生成批量定时下载的配置文件 python supervisor_api.py  setup-app-period-download

python supervisor_api.py --help 会打印帮助信息


# 7 将 supervisor 按装成系统服务

需要用管理员身份运行 cmd 或 PowerShell

确保第六步运行没有问题后再执行安装

安装  python supervisor_api.py install

卸载 python supervisor_api.py uninstall

打开系统服务程序 services.msc 找到 Supervisord Service，将它设置为自动启动，并启动服务

